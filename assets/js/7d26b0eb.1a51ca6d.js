"use strict";(self.webpackChunkdocs_api=self.webpackChunkdocs_api||[]).push([[6136],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>g});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var o=a.createContext({}),l=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},p=function(e){var n=l(e.components);return a.createElement(o.Provider,{value:n},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),d=l(t),u=r,g=d["".concat(o,".").concat(u)]||d[u]||m[u]||i;return t?a.createElement(g,s(s({ref:n},p),{},{components:t})):a.createElement(g,s({ref:n},p))}));function g(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,s=new Array(i);s[0]=u;var c={};for(var o in n)hasOwnProperty.call(n,o)&&(c[o]=n[o]);c.originalType=e,c[d]="string"==typeof e?e:r,s[1]=c;for(var l=2;l<i;l++)s[l]=t[l];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},21274:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var a=t(87462),r=(t(67294),t(3905));const i={sidebar_label:"Setting up an FMC Screen",sidebar_position:3},s="Setting up an FMC Screen",c={unversionedId:"fmc/setting-up-an-fmc-screen",id:"fmc/setting-up-an-fmc-screen",title:"Setting up an FMC Screen",description:"We will now see how we can configure a simple FMC screen, to a point where it is rendering and can have pages added to it.",source:"@site/docs/fmc/setting-up-an-fmc-screen.md",sourceDirName:"fmc",slug:"/fmc/setting-up-an-fmc-screen",permalink:"/msfs-avionics-mirror/docs/fmc/setting-up-an-fmc-screen",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_label:"Setting up an FMC Screen",sidebar_position:3},sidebar:"sidebar",previous:{title:"Pages, Components and Templates",permalink:"/msfs-avionics-mirror/docs/fmc/pages-components-templates"},next:{title:"Creating Your First Page",permalink:"/msfs-avionics-mirror/docs/fmc/creating-your-first-page"}},o={},l=[{value:"Creating an FMC Screen Class",id:"creating-an-fmc-screen-class",level:2},{value:"Defining an event type",id:"defining-an-event-type",level:3},{value:"Creating a page class",id:"creating-a-page-class",level:3},{value:"Creating a page factory",id:"creating-a-page-factory",level:3},{value:"Creating the actual FMC screen class",id:"creating-the-actual-fmc-screen-class",level:3},{value:"Configuring the FMC Screen",id:"configuring-the-fmc-screen",level:2},{value:"Creating a Stylesheet",id:"creating-a-stylesheet",level:2},{value:"Instantiating and Rendering the FMC Screen",id:"instantiating-and-rendering-the-fmc-screen",level:2},{value:"Setting up events",id:"setting-up-events",level:3}],p={toc:l},d="wrapper";function m(e){let{components:n,...t}=e;return(0,r.kt)(d,(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"setting-up-an-fmc-screen"},"Setting up an FMC Screen"),(0,r.kt)("p",null,"We will now see how we can configure a simple FMC screen, to a point where it is rendering and can have pages added to it."),(0,r.kt)("h2",{id:"creating-an-fmc-screen-class"},"Creating an FMC Screen Class"),(0,r.kt)("p",null,"An FMC screen for a specific CDU starts with creating a class extending ",(0,r.kt)("inlineCode",{parentName:"p"},"FmcScreen"),". This class has two type parameters; the first one\nindicates which class the pages on this screen will extend, and the second one defines which events can be sent to the screen."),(0,r.kt)("p",null,"You will first need to create those two types."),(0,r.kt)("h3",{id:"defining-an-event-type"},"Defining an event type"),(0,r.kt)("p",null,"The event type on the FMC screen is used to register certain events as performing specific actions on the FMC screen. Examples of events\nthat are commonly found include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Line select keys (LSKs);"),(0,r.kt)("li",{parentName:"ul"},"Scrolling keys (left/previous, right/next, up, down);"),(0,r.kt)("li",{parentName:"ul"},"Page/mode keys (FPLN, LEGS, PERF, INDEX etc.);"),(0,r.kt)("li",{parentName:"ul"},"Scratchpad keys (alphanumeric keys, ",(0,r.kt)("inlineCode",{parentName:"li"},"+/-"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"/"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"."),", etc.).")),(0,r.kt)("p",null,"You can create an event type with a plain TypeScript ",(0,r.kt)("inlineCode",{parentName:"p"},"interface"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'interface MyFmcEvents {\n  // Each line select key must be a distinct event\n  lsk_1_l: void;\n\n  lsk_1_r: void;\n\n  prev_page: void;\n\n  next_page: void;\n\n  // It is recommended to use a singular event for text being input into the scratchpad, to avoid having to create 36 separate events\n  // for all alphanumeric values\n  scratchpad_type: string;\n\n  // "Special" keys should however have their own events\n  scratchpad_plus_mins: void;\n\n  example_page: void;\n\n  example_page_2: void;\n}\n')),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"As some events are ",(0,r.kt)("em",{parentName:"p"},"nullary")," (meaning they take no arguments), we can use ",(0,r.kt)("inlineCode",{parentName:"p"},"void")," to not have to specify a value to pass into the event.\nWhen firing those events, use ",(0,r.kt)("inlineCode",{parentName:"p"},"undefined")," as the payload value.")),(0,r.kt)("h3",{id:"creating-a-page-class"},"Creating a page class"),(0,r.kt)("p",null,"Pages for a specific FMC screen must all extend the same base class, which can contain functionality specific to this CDU."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"/**\n * A test FMC page class\n */\nexport class MyFmcPage extends AbstractFmcPage {\n  /**\n   * Ctor\n   * @param bus the event bus\n   * @param screen the FMC screen\n   * @param renderCallback the FMC render callback\n   */\n  constructor(\n    bus: EventBus,\n    screen: FmcScreen<MyFmcPage, MyFmcEvents>, // This can be replaced with your avionics-specific FMC screen class later on\n    public readonly renderCallback: FmcRenderCallback\n  ) {\n    super(bus, screen);\n  }\n\n  /** @inheritDoc */\n  render(): FmcRenderTemplate[] {\n    return [];\n  }\n}\n")),(0,r.kt)("h3",{id:"creating-a-page-factory"},"Creating a page factory"),(0,r.kt)("p",null,"Since the FMC screen creates pages automatically, a page factory is necessary."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"export class MyFmcPageFactory extends FmcPageFactory<MyFmcPage> {\n  createPage(\n    pageCtor: typeof MyFmcPage,\n    bus: EventBus,\n    screen: FmcScreen<MyFmcPage, any>,\n    renderCallback: FmcRenderCallback\n  ): MyFmcPage {\n    return new pageCtor(bus, screen, renderCallback);\n  }\n}\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"If your page class requires more constructor arguments (a common pattern is passing in an FMS or flight planner instance), add those as constructor properties\nto your ",(0,r.kt)("inlineCode",{parentName:"p"},"MyFmcPageFactory")," class:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"export class MyFmcPageFactory extends FmcPageFactory<MyFmcPage> {\n  constructor(private readonly fms: MyFms) {\n    super();\n  }\n\n  /* ... */\n}\n"))),(0,r.kt)("h3",{id:"creating-the-actual-fmc-screen-class"},"Creating the actual FMC screen class"),(0,r.kt)("p",null,"Using ",(0,r.kt)("a",{parentName:"p",href:"#creating-a-page-class"},(0,r.kt)("inlineCode",{parentName:"a"},"MyFmcPage")),", ",(0,r.kt)("a",{parentName:"p",href:"#defining-an-event-type"},(0,r.kt)("inlineCode",{parentName:"a"},"MyFmcEvents"))," and ",(0,r.kt)("a",{parentName:"p",href:"#creating-a-page-factory"},(0,r.kt)("inlineCode",{parentName:"a"},"MyFmcPageFactory")),",\nwe can create our class extending ",(0,r.kt)("a",{parentName:"p",href:"/docs/framework/classes/FmcScreen"},(0,r.kt)("inlineCode",{parentName:"a"},"FmcScreen")),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const MY_CDU_CELL_WIDTH = 24;\nconst MY_CDU_CELL_HEIGHT = 14;\n\nexport class MyFmcScreen extends FmcScreen<MyFmcPage, MyFmcEvents> {\n  constructor(bus: EventBus, renderTarget: HTMLDivElement) {\n    super(\n      bus,\n      new MyFmcPageFactory(),\n      { screenDimensions: { cellWidth: MY_CDU_CELL_WIDTH, cellHeight: MY_CDU_CELL_HEIGHT }, enableScratchpad: false },\n      new SimpleFmcRenderer(bus, renderTarget, {\n        screenCellWidth: MY_CDU_CELL_WIDTH,\n        screenCellHeight: MY_CDU_CELL_HEIGHT,\n        screenPXWidth: 800,\n        screenPXHeight: 600,\n      }),\n      new FmcScratchpad(bus, { cellWidth: UNS_CDU_CELL_WIDTH }, () => {})\n    );\n  }\n}\n")),(0,r.kt)("h2",{id:"configuring-the-fmc-screen"},"Configuring the FMC Screen"),(0,r.kt)("p",null,"When creating the ",(0,r.kt)("inlineCode",{parentName:"p"},"FmcScreen")," class, you will need to pass a partial ",(0,r.kt)("a",{parentName:"p",href:"/docs/framework/interfaces/FmcScreenOptions"},(0,r.kt)("inlineCode",{parentName:"a"},"FmcScreenOptions"))," interface which provides multiple options regarding screen size, etc."),(0,r.kt)("p",null,"Additionally, you may wish to override some of the default behaviours of the ",(0,r.kt)("inlineCode",{parentName:"p"},"FmcScreen")," class, such as to display an overlay. If you wish to override the default page output, such as for displaying an overlay, you can do so by modifying the rendered output in the ",(0,r.kt)("inlineCode",{parentName:"p"},"acceptPageOutput")," function of ",(0,r.kt)("inlineCode",{parentName:"p"},"MyFmcScreen"),"."),(0,r.kt)("h2",{id:"creating-a-stylesheet"},"Creating a Stylesheet"),(0,r.kt)("p",null,"The FMC framework uses simple CSS for styling, allowing developers to simply include and import a css stylesheet.\nFor more information regarding styling, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/fmc/styling"},(0,r.kt)("inlineCode",{parentName:"a"},"styling"))),(0,r.kt)("h2",{id:"instantiating-and-rendering-the-fmc-screen"},"Instantiating and Rendering the FMC Screen"),(0,r.kt)("p",null,"It is recommended to contain the initialization of the FMC screen into its own component where pages and events are configured:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"/**\n * Props for {@link MyCduDisplay}\n */\nexport interface MyCduDisplayProps extends ComponentProps {\n  /** The event bus */\n  bus: EventBus;\n}\n\n/**\n * My CDU display component\n */\nexport class MyCduDisplay extends DisplayComponent<MyCduDisplayProps> {\n  private readonly fmcScreenRef = FSComponent.createRef<HTMLDivElement>();\n\n  private myFmcScreen: MyFmcScreen | undefined;\n\n  /** @inheritDoc */\n  public override onAfterRender(node: VNode): void {\n    super.onAfterRender(node);\n\n    // We instantiate our FMC screen, passsing in the bus and the element we want it to render its content grid to\n    this.myFmcScreen = new MyFmcScreen(\n      this.props.bus,\n      this.fmcScreenRef.instance\n    );\n\n    this.fmcScreen && this.initialiseFmcScreen(this.fmcScreen);\n  }\n\n  /**\n   * Initialises the FMC screen\n   * @param fmcScreen The UnsFmcScreen instance\n   */\n  private initialiseFmcScreen(fmcScreen: MyFmcScreen): void {\n    // ...we configure this later\n  }\n\n  /** @inheritDoc */\n  public override render(): VNode | null {\n    return <div ref={this.fmcScreenRef} />;\n  }\n}\n")),(0,r.kt)("h3",{id:"setting-up-events"},"Setting up events"),(0,r.kt)("p",null,"In order for our FMC screen to respond appropriately to different events, we must tell it which events correspond to\nwhat actions. (see ",(0,r.kt)("a",{parentName:"p",href:"#defining-an-event-type"},"Defining an event type"),")."),(0,r.kt)("p",null,"This is done by calling a couple of utility methods on ",(0,r.kt)("inlineCode",{parentName:"p"},"FmcScreen"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'class MyCduDisplay /* ... */ {\n  /* ... */\n  private initialiseFmcScreen(fmcScreen: MyFmcScreen): void {\n    // Here, we configure which events (keys of the event interface we specify as the second type parameter\n    // of `FmcScreen` in `MyFmcScreen` - in this case, `MyFmcEvents`) correspond to which line select keys, associating them\n    // with row indices and column indices (referring to the left/right automatic layout columns) they correspond to.\n    // Any components present at that location will receive those events.\n    fmcScreen.addLskEvents([\n      ["lsk_1_l", 2, 0],\n      ["lsk_1_r", 2, 1],\n    ]);\n\n    // We do the same for scrolling events. It is not nevessary to specify every possible scrolling event, as few CDUs have\n    // dedicated up/down scrolling keys.\n    fmcScreen.addPagingEvents({\n      pageLeft: "prev_page",\n      pageRight: "next_page",\n    });\n\n    // For events the FMC screen does not handle automatically, you can easily get a consumer to events, prefixed with\n    // the event prefix configured on the FMC screen (by default, none). The prefix is configured when you need tow distinct\n    // CDUs which respond to separate events. This is automatically taken care of by `addLskEvents`, `addPagingEvents` and `addPageRoute`.\n    //\n    // The prefix can be configured using the `eventPeefix` property of the `FmcScreenOptions` object we pass to the\n    // parent class in the `MyFmcScreen` constructor.\n    fmcScreen.onPrefixedEvent("scratchpad_plus_mins").handle(() => {\n      /* ... */\n    });\n  }\n  /* ... */\n}\n')),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The FMC Framework does not publish events automatically, only ",(0,r.kt)("em",{parentName:"p"},"consumes")," them. The most common way of publishing events is\nvia ",(0,r.kt)("a",{parentName:"p",href:"/docs/interacting-with-msfs/receiving-h-events"},"Receiving H Events"),", and re-publishing\nthose (conforming to the created event interface) on the ",(0,r.kt)("a",{parentName:"p",href:"/docs/getting-started/using-the-event-bus"},"event bus"),"."),(0,r.kt)("p",{parentName:"admonition"},"It is good practice to use H Events even if your CDU buttons are virtual. This is because users employing\nexternal software or hardware controls can easily emit H Events, but not EventBus events.")))}m.isMDXComponent=!0}}]);