"use strict";(self.webpackChunkdocs_api=self.webpackChunkdocs_api||[]).push([["644736"],{766069:function(e,n,i){i.r(n),i.d(n,{metadata:()=>s,contentTitle:()=>o,default:()=>h,assets:()=>l,toc:()=>d,frontMatter:()=>a});var s=JSON.parse('{"id":"framework-systems/fmc/plugin-support","title":"Plugin Support","description":"The FMC framework includes support for extending or replacing functionality through the plugin system.","source":"@site/docs/framework-systems/fmc/plugin-support.md","sourceDirName":"framework-systems/fmc","slug":"/framework-systems/fmc/plugin-support","permalink":"/msfs-avionics-mirror/2024/docs/framework-systems/fmc/plugin-support","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"sidebar_label":"Plugin Support","sidebar_position":11},"sidebar":"sidebar","previous":{"title":"Configuring a Scratchpad","permalink":"/msfs-avionics-mirror/2024/docs/framework-systems/fmc/configuring-a-scratchpad"},"next":{"title":"SoundServer","permalink":"/msfs-avionics-mirror/2024/docs/framework-systems/sounds/soundserver"}}'),t=i("785893"),r=i("250065");let a={sidebar_label:"Plugin Support",sidebar_position:11},o="Plugin Support",l={},d=[{value:"Considerations for instrument developers when planning plugin support",id:"considerations-for-instrument-developers-when-planning-plugin-support",level:2},{value:"Adding pages via plugins",id:"adding-pages-via-plugins",level:2},{value:"route",id:"route",level:4},{value:"page",id:"page",level:4},{value:"event",id:"event",level:4},{value:"defaultProps",id:"defaultprops",level:4},{value:"Extending pre-existing pages",id:"extending-pre-existing-pages",level:2},{value:"Creating the page extension",id:"creating-the-page-extension",level:3},{value:"onPageRendered",id:"onpagerendered",level:4},{value:"onPageInit",id:"onpageinit",level:4},{value:"onPageResume",id:"onpageresume",level:4},{value:"onPagePause",id:"onpagepause",level:4},{value:"onPageHandleSelectKey",id:"onpagehandleselectkey",level:4},{value:"onPageHandleScrolling",id:"onpagehandlescrolling",level:4},{value:"Registering the page extension",id:"registering-the-page-extension",level:3},{value:"pageClass",id:"pageclass",level:4},{value:"extension",id:"extension",level:4},{value:"Replacing pre-existing pages",id:"replacing-pre-existing-pages",level:2},{value:"route",id:"route-1",level:4},{value:"page",id:"page-1",level:4},{value:"routeEvent",id:"routeevent",level:4}];function c(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"plugin-support",children:"Plugin Support"})}),"\n",(0,t.jsx)(n.p,{children:"The FMC framework includes support for extending or replacing functionality through the plugin system."}),"\n",(0,t.jsx)(n.admonition,{type:"danger",children:(0,t.jsx)(n.p,{children:"If multiple FMC plugins are registered, then there is no defined order in which they run. They will be ran in the order on which they load, which is unpredictable and can change due to performance. This may be especially problematic where multiple plugins attempt to handle events as one plugin may be considered to have handled the event, when the desired effect is that the other plugin does so."})}),"\n",(0,t.jsx)(n.h2,{id:"considerations-for-instrument-developers-when-planning-plugin-support",children:"Considerations for instrument developers when planning plugin support"}),"\n",(0,t.jsx)(n.p,{children:"When an instrument developer is planning to support the use of plugins with the FMC framework, they must consider the functions that they pass to the plugin, along with the page classes provided in a plugin package."}),"\n",(0,t.jsxs)(n.p,{children:["To allow for plugin developers to extend the FMC in any capacity, instrument developers must make available a function which provides an ",(0,t.jsx)(n.a,{href:"/msfs-avionics-mirror/2024/docs/api/framework/interfaces/FmcScreenPluginContext",children:(0,t.jsx)(n.code,{children:"FmcScreenPluginContext<InstrumentFmcPage, InstrumentFmcEvents>"})})," where ",(0,t.jsx)(n.code,{children:"InstrumentFmcPage"})," is the page class used within the instrument (i.e. ",(0,t.jsx)(n.code,{children:"Wt21FmcPage"}),"), and ",(0,t.jsx)(n.code,{children:"InstrumentFmcEvents"})," is the interface containing the events available."]}),"\n",(0,t.jsx)(n.p,{children:"Instrument developers will need to make available a number of classes and interfaces for plugin developers to provide proper support, such as:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The instrument-specific interface containing the FMC events (in the case of the WT21, this would be ",(0,t.jsx)(n.code,{children:"Wt21FmcEvents"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["The instrument-specific classes used for rendering pages (in the case of the WT21, this would be ",(0,t.jsx)(n.code,{children:"Wt21FmcPage"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"Any components which are available to be used for the rendering of the FMC, such as instrument-specific dialog pages, input fields, etc"}),"\n",(0,t.jsxs)(n.li,{children:["The classes which the instrument developer plans to support the extension of (in the case of the WT21, we support extension of ",(0,t.jsx)(n.code,{children:"PerfMenuPage"})," and ",(0,t.jsx)(n.code,{children:"PerfInitPage"})," among others)"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"adding-pages-via-plugins",children:"Adding pages via plugins"}),"\n",(0,t.jsxs)(n.p,{children:["It's possible to extend the FMC by creating new pages through a plugin. This can be done through the ",(0,t.jsx)(n.code,{children:"FmcScreenPluginContext::addPluginPageRoute(route, page, event, defaultProps)"})," function."]}),"\n",(0,t.jsxs)(n.p,{children:["To navigate to these pages, you use the ",(0,t.jsx)(n.code,{children:"FmcScreen::navigateTo(route, params)"})," function as you would in an instrument implementation of the FMC."]}),"\n",(0,t.jsx)(n.p,{children:"This function takes the following parameters:"}),"\n",(0,t.jsx)(n.h4,{id:"route",children:"route"}),"\n",(0,t.jsxs)(n.p,{children:["[",(0,t.jsx)(n.code,{children:"string"}),"]"]}),"\n",(0,t.jsx)(n.p,{children:"This string is the route to get to the specified page"}),"\n",(0,t.jsx)(n.h4,{id:"page",children:"page"}),"\n",(0,t.jsxs)(n.p,{children:["[",(0,t.jsx)(n.code,{children:"FmcPage implementation"}),"]"]}),"\n",(0,t.jsxs)(n.p,{children:["This parameter takes a class which is extended from the instrument-specific ",(0,t.jsx)(n.code,{children:"AbstractFmcPage"})," implementation, and corresponds to the page being displayed."]}),"\n",(0,t.jsx)(n.h4,{id:"event",children:"event"}),"\n",(0,t.jsxs)(n.p,{children:["[",(0,t.jsx)(n.code,{children:"string | undefined"}),"]"]}),"\n",(0,t.jsx)(n.p,{children:"This parameter, when defined, is the event that causes this page to be displayed. If undefined the page must be navigated to another way."}),"\n",(0,t.jsx)(n.h4,{id:"defaultprops",children:"defaultProps"}),"\n",(0,t.jsxs)(n.p,{children:["[",(0,t.jsx)(n.code,{children:"{[key: string]: any} | undefined"}),"]"]}),"\n",(0,t.jsxs)(n.p,{children:["This parameter, when defined, contains the default props that will be passed to the page. It can be useful for passing objects from the binder, such as an ",(0,t.jsx)(n.code,{children:"Fms"})," object, or a ",(0,t.jsx)(n.code,{children:"PerformancePlan"})," object."]}),"\n",(0,t.jsx)(n.h2,{id:"extending-pre-existing-pages",children:"Extending pre-existing pages"}),"\n",(0,t.jsx)(n.p,{children:"The FMC framework also provides support for extending and modifying pages which already exist in the FMC. This can be useful for cases such as performance planning, where different aircraft may have different support for performance planning approaches or takeoff - such as in the WT21 where there is no pre-existing support for performance calculations of takeoff or approach, but which is provided in the CJ4 FMC."}),"\n",(0,t.jsx)(n.h3,{id:"creating-the-page-extension",children:"Creating the page extension"}),"\n",(0,t.jsxs)(n.p,{children:["To extend an already existing FMC page, you need to create a class which extends from ",(0,t.jsx)(n.a,{href:"/msfs-avionics-mirror/2024/docs/api/framework/classes/AbstractFmcPageExtension",children:(0,t.jsx)(n.code,{children:"AbstractFmcPageExtension"})}),"."]}),"\n",(0,t.jsx)(n.p,{children:"This class provides a number of functions to extend behaviour:"}),"\n",(0,t.jsx)(n.h4,{id:"onpagerendered",children:"onPageRendered"}),"\n",(0,t.jsx)(n.p,{children:"This is the main reason for extending a page - changing the rendering of a page itself.\r\nThis function contains one parameter, which is the rendered FMC template. From this, you are able to replace or create new entries in the rendered page. An example of how this may be used is as below:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'export class PerfMenuPageExtension extends AbstractFmcPageExtension<PerfMenuPage> {\r\n  private readonly TakeoffPerfLink = PageLinkField.createLink(this.page, "<TAKEOFF", "/takeoff-ref");\r\n\r\n  private readonly ApproachPerfLink = PageLinkField.createLink(this.page, "APPROACH>", "/approach-ref");\r\n\r\n  /** @inheritDoc */\r\n  public onPageRendered(renderedTemplates: FmcRenderTemplate[]): void {\r\n    renderedTemplates[0][6] = [this.TakeoffPerfLink, this.ApproachPerfLink];\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"onpageinit",children:"onPageInit"}),"\n",(0,t.jsx)(n.p,{children:"This function is called when the extended page is initialised. This function is called before the page runs it's onInit function."}),"\n",(0,t.jsx)(n.h4,{id:"onpageresume",children:"onPageResume"}),"\n",(0,t.jsx)(n.p,{children:"This function is called when the extended page is resumed. This function is called after the page runs it's onPause function."}),"\n",(0,t.jsx)(n.h4,{id:"onpagepause",children:"onPagePause"}),"\n",(0,t.jsx)(n.p,{children:"This function is called when the extended page is paused. This function is called after the page runs it's onResume function."}),"\n",(0,t.jsx)(n.h4,{id:"onpagehandleselectkey",children:"onPageHandleSelectKey"}),"\n",(0,t.jsxs)(n.p,{children:["This function is called before the page processes a select key event. If this function returns ",(0,t.jsx)(n.code,{children:"true"})," then the select key is considered to have been handled and the page will not process it."]}),"\n",(0,t.jsx)(n.h4,{id:"onpagehandlescrolling",children:"onPageHandleScrolling"}),"\n",(0,t.jsxs)(n.p,{children:["This function is called before the page processes a scrolling event. If this function returns ",(0,t.jsx)(n.code,{children:"true"})," then the select key is considered to have been handled and the page will not process it."]}),"\n",(0,t.jsx)(n.h3,{id:"registering-the-page-extension",children:"Registering the page extension"}),"\n",(0,t.jsxs)(n.p,{children:["To extend an already existing page, you use the ",(0,t.jsx)(n.code,{children:"FmcScreenPluginContext::attachPageExtension(pageClass, extension)"})," function."]}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"context.attachPageExtension(PerfMenuPage, PerfMenuPageExtension);\n"})}),"\n",(0,t.jsx)(n.p,{children:"The parameters are as follows:"}),"\n",(0,t.jsx)(n.h4,{id:"pageclass",children:"pageClass"}),"\n",(0,t.jsxs)(n.p,{children:["[",(0,t.jsx)(n.code,{children:"FmcPage implementation"}),"]"]}),"\n",(0,t.jsxs)(n.p,{children:["This parameter should contain the class of the specific page which is being implemented. For example in the WT21, you might pass ",(0,t.jsx)(n.code,{children:"PerfMenuPage"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"extension",children:"extension"}),"\n",(0,t.jsxs)(n.p,{children:["[",(0,t.jsx)(n.code,{children:"class extending AbstractFmcPageExtension"}),"]"]}),"\n",(0,t.jsxs)(n.p,{children:["This parameter should contain the unconstructed and uninstantiated class which extends ",(0,t.jsx)(n.a,{href:"/msfs-avionics-mirror/2024/docs/api/framework/classes/AbstractFmcPageExtension",children:(0,t.jsx)(n.code,{children:"AbstractFmcPageExtension"})})]}),"\n",(0,t.jsx)(n.h2,{id:"replacing-pre-existing-pages",children:"Replacing pre-existing pages"}),"\n",(0,t.jsxs)(n.p,{children:["It is possible to entirely replace an existing page route. This can be done through the ",(0,t.jsx)(n.code,{children:"FmcScreenPluginContext::replacePageRoute(route, page, routeEvent)"})," function, which takes the following parameters:"]}),"\n",(0,t.jsx)(n.h4,{id:"route-1",children:"route"}),"\n",(0,t.jsxs)(n.p,{children:["[",(0,t.jsx)(n.code,{children:"string"}),"]"]}),"\n",(0,t.jsx)(n.p,{children:"The page route to be replaced."}),"\n",(0,t.jsx)(n.h4,{id:"page-1",children:"page"}),"\n",(0,t.jsxs)(n.p,{children:["[",(0,t.jsx)(n.code,{children:"FmcPage implementation"}),"]"]}),"\n",(0,t.jsx)(n.p,{children:"The page which this route should direct to."}),"\n",(0,t.jsx)(n.h4,{id:"routeevent",children:"routeEvent"}),"\n",(0,t.jsxs)(n.p,{children:["[",(0,t.jsx)(n.code,{children:"string | undefined"}),"]"]}),"\n",(0,t.jsx)(n.p,{children:"The event which will cause this page to be displayed, or undefined where this wouldn't occur."}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"If you replace a page route which has a defined routeEvent, you will need to also define the routeEvent for the replacement page if you wish to have that event still cause the same page route to be displayed."})})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return o},a:function(){return a}});var s=i(667294);let t={},r=s.createContext(t);function a(e){let n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);