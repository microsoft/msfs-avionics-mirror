"use strict";(self.webpackChunkdocs_api=self.webpackChunkdocs_api||[]).push([["381849"],{651774:function(e,t,s){s.r(t),s.d(t,{metadata:()=>a,contentTitle:()=>o,default:()=>h,assets:()=>l,toc:()=>c,frontMatter:()=>r});var a=JSON.parse('{"id":"framework-systems/cas/cas-system","title":"CAS System","description":"Introduction","source":"@site/docs/framework-systems/cas/cas-system.md","sourceDirName":"framework-systems/cas","slug":"/framework-systems/cas/cas-system","permalink":"/msfs-avionics-mirror/2024/docs/framework-systems/cas/cas-system","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"CAS System","sidebar_position":1},"sidebar":"sidebar","previous":{"title":"Defining Aural Alerts Using panel.xml","permalink":"/msfs-avionics-mirror/2024/docs/framework-systems/sounds/defining-aural-alerts-using-panel-xml"},"next":{"title":"Defining CAS Alerts Using panel.xml","permalink":"/msfs-avionics-mirror/2024/docs/framework-systems/cas/defining-cas-alerts-using-panel-xml"}}'),i=s("785893"),n=s("250065");let r={sidebar_label:"CAS System",sidebar_position:1},o="CAS System",l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"System Description",id:"system-description",level:2},{value:"Setting Up the System",id:"setting-up-the-system",level:2},{value:"Registering Alerts",id:"registering-alerts",level:2},{value:"Activating Alerts",id:"activating-alerts",level:2},{value:"Deactivating Alerts",id:"deactivating-alerts",level:2},{value:"Using <code>CasAlertTransporter</code>",id:"using-casalerttransporter",level:2},{value:"Acknowledging Alerts",id:"acknowledging-alerts",level:2},{value:"Alert Debounce",id:"alert-debounce",level:2},{value:"Inhibit States",id:"inhibit-states",level:2},{value:"Consuming CAS State",id:"consuming-cas-state",level:2}];function d(e){let t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"cas-system",children:"CAS System"})}),"\n",(0,i.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(t.p,{children:"CAS System is an SDK API that aims to provide a generic framework from which you can build a CAS (crew alerting system) for your specific avionics system. The API provides classes that handle much of the state logic involved in deciding which CAS alerts should be displayed. By design, the API provides limited support for actually rendering CAS displays since those details are largely avionics/airplane-specific."}),"\n",(0,i.jsx)(t.h2,{id:"system-description",children:"System Description"}),"\n",(0,i.jsxs)(t.p,{children:["CAS System is based on the concept of ",(0,i.jsx)(t.em,{children:"alerts"})," and ",(0,i.jsx)(t.em,{children:"messages"}),". An ",(0,i.jsx)(t.em,{children:"alert"})," represents a condition or state which, when ",(0,i.jsx)(t.em,{children:"true"})," or ",(0,i.jsx)(t.em,{children:"active"}),", should be communicated to the pilot through the CAS. A ",(0,i.jsx)(t.em,{children:"message"})," is a textual element that is displayed to the pilot by the CAS to communicate the presence of one or more alerts. As alerts are activated and deactivated, the CAS will display and hide their associated messages automatically."]}),"\n",(0,i.jsx)(t.p,{children:"An alert has three basic properties:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"ID"}),"\n",(0,i.jsx)(t.li,{children:"Message Text"}),"\n",(0,i.jsx)(t.li,{children:"Suffixes"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.em,{children:"ID"})," of an alert is used to identify and reference it. ",(0,i.jsx)(t.em,{children:"Each alert must have a unique ID"}),". The ID of an alert is never exposed or displayed to the user. On the other hand, the ",(0,i.jsx)(t.em,{children:"message text"})," of an alert determines the text that is displayed by CAS when the alert is active. Two different alerts are allowed to have the same message text. An alert's ",(0,i.jsx)(t.em,{children:"suffixes"})," are a list of possible text that is appended to the end of the message text when displaying the alert. Examples of commonly used suffixes include ",(0,i.jsx)(t.code,{children:"L"}),", ",(0,i.jsx)(t.code,{children:"R"}),", ",(0,i.jsx)(t.code,{children:"A"}),", ",(0,i.jsx)(t.code,{children:"B"}),", etc. An alert may have zero suffixes, in which case its message text will be all that is displayed."]}),"\n",(0,i.jsx)(t.h2,{id:"setting-up-the-system",children:"Setting Up the System"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"CasSystem"})," class handles the bulk of the CAS state logic. For the system to function, you must create at least one instance of ",(0,i.jsx)(t.code,{children:"CasSystem"})," on any of your airplane's JS/HTML instruments. Most CAS state information is not shared between instruments; therefore you must create one instance ",(0,i.jsx)(t.code,{children:"CasSystem"})," on each instrument that needs access to data provided by ",(0,i.jsx)(t.code,{children:"CasSystem"}),". Do not create more than one instance of ",(0,i.jsx)(t.code,{children:"CasSystem"})," on any given instrument - doing so will lead to undesired behavior."]}),"\n",(0,i.jsxs)(t.p,{children:["When instantiating ",(0,i.jsx)(t.code,{children:"CasSystem"}),", exactly one instance across all instruments must be designated as the ",(0,i.jsx)(t.em,{children:"primary"})," instance:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"import { CasSystem, EventBus } from '@microsoft/msfs-sdk';\r\n\r\nconst bus = new EventBus();\r\nnew CasSystem(bus, true /* designates this instance as the primary */);\n"})}),"\n",(0,i.jsx)(t.p,{children:"All other instances must be designated as non-primary:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"new CasSystem(bus, false);\r\n// ---- OR ----\r\nnew CasSystem(bus);\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Once ",(0,i.jsx)(t.code,{children:"CasSystem"})," is instantiated, it is ready to use."]}),"\n",(0,i.jsx)(t.h2,{id:"registering-alerts",children:"Registering Alerts"}),"\n",(0,i.jsxs)(t.p,{children:["Alerts must be registered with ",(0,i.jsx)(t.code,{children:"CasSystem"})," before they can be used. Registering an alert is done using the ",(0,i.jsx)(t.code,{children:"CasRegistrationManager"})," class:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"import { CasRegistrationManager, EventBus } from '@microsoft/msfs-sdk';\r\n\r\nconst bus = new EventBus();\r\nconst manager = new CasRegistrationManager(bus);\r\n\r\n// Registers an alert with ID 'parking-brake' which will display 'PARKING BRAKE' with no suffixes.\r\nmanager.register({\r\n  uuid: 'parking-brake',\r\n  message: 'PARKING BRAKE'\r\n});\r\n\r\n// Registers an alert with ID 'generator-off' which will display 'GEN OFF' with the 'L' and 'R' suffixes.\r\nmanager.register({\r\n  uuid: 'generator-off',\r\n  message: 'GEN OFF',\r\n  suffixes: ['L', 'R']\r\n});\n"})}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"register()"})," method takes in a single object that satisfies the ",(0,i.jsx)(t.code,{children:"CasAlertDefinition"})," type. The two properties required by ",(0,i.jsx)(t.code,{children:"CasAlertDefinition"})," are ",(0,i.jsx)(t.code,{children:"uuid"})," and ",(0,i.jsx)(t.code,{children:"message"}),", which define the ID and message text of the registered alert, respectively. The property ",(0,i.jsx)(t.code,{children:"suffix"})," is optional and is an array of strings that define the alert's suffixes. The order of suffixes in the array determine the order in which they will be displayed at the end of a message."]}),"\n",(0,i.jsx)(t.admonition,{type:"tip",children:(0,i.jsxs)(t.p,{children:["You don't have to wait for all ",(0,i.jsx)(t.code,{children:"CasSystem"})," instances to be created before registering alerts using ",(0,i.jsx)(t.code,{children:"CasRegistrationManager"}),". The manager will ensure that any instances of ",(0,i.jsx)(t.code,{children:"CasSystem"})," created after an alert was registered still receive the registration information for that alert."]})}),"\n",(0,i.jsx)(t.h2,{id:"activating-alerts",children:"Activating Alerts"}),"\n",(0,i.jsx)(t.p,{children:"Three pieces of information are needed to activate an alert: the ID of the alert, the suffix to activate, and the priority level at which to activate the alert."}),"\n",(0,i.jsxs)(t.p,{children:["When an alert is activated, a single message is displayed by the CAS with the alert's message text. For alerts with suffixes, each suffix is activated independently. No matter how many suffixes are active for a given alert, only one message is ever displayed; it is left up to individual CAS displays to determine how to present a message with multiple active suffixes. Finally, each alert (and suffix, if applicable) can be activated at four different priority levels (in order of decreasing priority): ",(0,i.jsx)(t.em,{children:"warning"}),", ",(0,i.jsx)(t.em,{children:"caution"}),", ",(0,i.jsx)(t.em,{children:"advisory"}),", and ",(0,i.jsx)(t.em,{children:"safeop"}),". Like with suffixes, each priority level is activated independently. If an alert is activated at multiple priority levels, the highest priority level takes precedence and only that priority level is displayed by the CAS."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"CasSystem"})," will automatically sort alert messages based on order of activation and priority level. Messages with higher priority always appear before messages with lower priority. Within the same priority level, messages are sorted such that those with the most recently activated alerts appear first. Activating an alert with suffix and priority level that were already activated does not count as a more recent activation."]}),"\n",(0,i.jsx)(t.p,{children:"The event bus is used to activate alerts:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"import { AnnunciationType, CasEvents } from '@microsoft/msfs-sdk';\r\n\r\n// Activates the alert with ID 'parking-brake' with no suffix and at advisory priority.\r\nbus.getPublisher<CasEvents>().pub('cas_activate_alert', {\r\n  key: { uuid: 'parking-brake' },\r\n  priority: AnnunciationType.Advisory\r\n}, true, false);\r\n\r\n// Activates the alert with ID 'generator-off' with the 'L' suffix and at caution priority.\r\nbus.getPublisher<CasEvents>().pub('cas_activate_alert', {\r\n  key: { uuid: 'generator-off', suffix: 'L' },\r\n  priority: AnnunciationType.Caution\r\n}, true, false);\n"})}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"CasEvents"})," interface defines event bus topics related to CAS. The ",(0,i.jsx)(t.code,{children:"cas_activate_alert"})," topic is used to activate alerts, and requires event data in the form of an object that has the ",(0,i.jsx)(t.code,{children:"key"})," and ",(0,i.jsx)(t.code,{children:"priority"})," properties. The ",(0,i.jsx)(t.code,{children:"key"})," property defines the ID and optionally suffix of the alert to activate. The ",(0,i.jsx)(t.code,{children:"priority"})," property defines the priority level at which to activate the alert as a member of the ",(0,i.jsx)(t.code,{children:"AnnunciationType"})," enum."]}),"\n",(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsxs)(t.p,{children:["When publishing the ",(0,i.jsx)(t.code,{children:"cas_activate_alert"})," topic, you ",(0,i.jsx)(t.strong,{children:"must"})," specify that the topic be synced to other instruments and not cached (the third and fourth parameters of ",(0,i.jsx)(t.code,{children:"pub()"}),", respectively). Failure to specify these options will result in incorrect behavior."]})}),"\n",(0,i.jsx)(t.h2,{id:"deactivating-alerts",children:"Deactivating Alerts"}),"\n",(0,i.jsx)(t.p,{children:"Deactivating an alert will cause it to not be displayed as a message. Like with activation, deactivating alerts is done independently for each suffix and each priority level. The event bus is used to deactivate alerts using syntax similar to that used to activate alerts:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"import { AnnunciationType, CasEvents } from '@microsoft/msfs-sdk';\r\n\r\n// Deactivates the alert with ID 'generator-off' with the 'L' suffix and at caution priority.\r\nbus.getPublisher<CasEvents>().pub('cas_deactivate_alert', {\r\n  key: { uuid: 'generator-off', suffix: 'L' },\r\n  priority: AnnunciationType.Caution\r\n}, true, false);\n"})}),"\n",(0,i.jsxs)(t.h2,{id:"using-casalerttransporter",children:["Using ",(0,i.jsx)(t.code,{children:"CasAlertTransporter"})]}),"\n",(0,i.jsxs)(t.p,{children:["While it is always possible to manually activate and deactivate alerts using the event bus as shown above, most of the time you will end up wanting to bind the activation state of an alert to some set of conditions that can be reduced to a boolean state. Since this pattern is so common, we have provided a convenience class that allows you to do that while minimizing repetitive boilerplate: ",(0,i.jsx)(t.code,{children:"CasAlertTransporter"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"CasAlertTransporter"})," allows you to bind the activation state of an alert to a boolean value, taken either from a ",(0,i.jsx)(t.code,{children:"Subscribable"})," or a custom update loop. It also allows you to directly set the activation state with its ",(0,i.jsx)(t.code,{children:"set()"})," method."]}),"\n",(0,i.jsxs)(t.p,{children:["Let's say that we want to activate the ",(0,i.jsx)(t.code,{children:"parking-brake"})," CAS alert at advisory priority whenever the parking brake is engaged. We can do that using the following code:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"import { AnnunciationType, CasAlertTransporter, SimVarValueType } from '@microsoft/msfs-sdk';\r\n\r\nCasAlertTransporter.create(bus, 'parking-brake', AnnunciationType.Advisory)\r\n  .bindUpdate(() => SimVar.GetSimVarValue('BRAKE PARKING POSITION', SimVarValueType.Bool) !== 0);\n"})}),"\n",(0,i.jsxs)(t.p,{children:["The above code will evaluate the ",(0,i.jsx)(t.code,{children:"BRAKE PARKING POSITION"})," simvar in an update loop and use the result to activate/deactivate the ",(0,i.jsx)(t.code,{children:"parking-brake"})," alert accordingly."]}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsxs)(t.p,{children:["Update loops spawned by ",(0,i.jsx)(t.code,{children:"CasAlertTransporter"})," update every JS instrument frame. The performance overhead for each update loop is relatively minor. However, we still recommend that you reserve the use of update loops for when the bound state cannot be evaluated in an event-driven manner."]})}),"\n",(0,i.jsxs)(t.p,{children:["Here's another example where ",(0,i.jsx)(t.code,{children:"CasAlertTransporter"})," is used to control activation of a low-fuel alert with suffixes - this time using event-driven logic:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"CasAlertTransporter.create(bus, 'fuel-low', AnnunciationType.Caution, 'L')\r\n  .bind(ConsumerSubject.create(bus.getSubscriber<EngineEvents>().on('fuel_left'), 0), fuel => fuel < 10);\r\n\r\nCasAlertTransporter.create(bus, 'fuel-low', AnnunciationType.Caution, 'R')\r\n  .bind(ConsumerSubject.create(bus.getSubscriber<EngineEvents>().on('fuel_right'), 0), fuel => fuel < 10);\n"})}),"\n",(0,i.jsxs)(t.p,{children:["For more detailed information on ",(0,i.jsx)(t.code,{children:"CasAlertTransporter"}),", please refer to the ",(0,i.jsx)(t.a,{href:"/msfs-avionics-mirror/2024/docs/api/framework/classes/CasAlertTransporter",children:"API documentation"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"acknowledging-alerts",children:"Acknowledging Alerts"}),"\n",(0,i.jsxs)(t.p,{children:["When an alert is activated at the warning or caution priority levels, it will cause the master warning or caution state to become active, respectively. Once active, the master warning and caution states remain that way until alerts are acknowledged. Acknowledging alerts can be done at each of the warning or caution priority levels by triggering the ",(0,i.jsx)(t.code,{children:"MASTER_WARNING_ACKNOWLEDGE"})," and ",(0,i.jsx)(t.code,{children:"MASTER_CAUTION_ACKNOWLEDGE"})," key events. The master warning and caution states can be read from the local vars ",(0,i.jsx)(t.code,{children:"L:Generic_Master_Warning_Active"})," and ",(0,i.jsx)(t.code,{children:"L:Generic_Master_Caution_Active"})," (0 = inactive, 1 = active)."]}),"\n",(0,i.jsx)(t.h2,{id:"alert-debounce",children:"Alert Debounce"}),"\n",(0,i.jsx)(t.p,{children:"For certain alerts, you may wish to delay displaying a CAS message for an alert until the alert has been active for a certain amount of time. CAS System provides support for this so that you don't have to manage your own timers. Debounce delays can be specified for an alert during registration:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"// Adds a 2000-millisecond debounce delay to the 'generator-off' alert.\r\nmanager.register({\r\n  uuid: 'generator-off',\r\n  message: 'GEN OFF',\r\n  suffixes: ['L', 'R'],\r\n  debounceTime: 2000\r\n});\n"})}),"\n",(0,i.jsx)(t.p,{children:"When activating a debounced alert, the delay is tracked separately for each suffix and priority level. Deactivating an alert will reset the debounce timer for the deactivated suffix/priority level."}),"\n",(0,i.jsx)(t.h2,{id:"inhibit-states",children:"Inhibit States"}),"\n",(0,i.jsxs)(t.p,{children:["A common scenario when working with CAS is needing to inhibit some alerts from being displayed at certain times, even if the conditions required to activate those alerts are met. This can be done through the use of ",(0,i.jsx)(t.em,{children:"inhibit states"}),". Each alert can optionally declare a set of inhibit states such that when any of those inhibit states are active, the alert will not be displayed as a message, even if activated by ",(0,i.jsx)(t.code,{children:"cas_activate_alert"}),". Inhibit states are activated and deactivated using the ",(0,i.jsx)(t.code,{children:"cas_activate_inhibit_state"})," and ",(0,i.jsx)(t.code,{children:"cas_deactivate_inhibit_state"})," event bus topics, respectively."]}),"\n",(0,i.jsx)(t.p,{children:"Here is an example of how to declare an inhibit state for an alert and how to activate and deactivate an inhibit state:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"// Registers a FUEL TEMP MISCOMPARE alert that is inhibited by the 'in-air' state.\r\nmanager.register({\r\n  uuid: 'fuel-temp-miscompare',\r\n  message: 'FUEL TEMP MISCOMPARE',\r\n  inhibitedBy: ['in-air']\r\n});\r\n\r\n// Activates/deactivates the 'in-air' inhibit state based on whether the aircraft is on the ground.\r\nbus.getSubscriber<AdcEvents>().on('on_ground').whenChanged().handle(isOnGround => {\r\n  bus.getPublisher<CasEvents>().pub(isOnGround ? 'cas_deactivate_inhibit_state' : 'cas_activate_inhibit_state', 'in-air', true, false);\r\n});\n"})}),"\n",(0,i.jsx)(t.p,{children:"If an inhibit state becomes active, any messages for already-active alerts affected by the inhibit state will be removed from the CAS. Once all inhibit states affecting an alert become deactivated and the alert is still active, a message for the alert will immediately appear on the CAS."}),"\n",(0,i.jsx)(t.h2,{id:"consuming-cas-state",children:"Consuming CAS State"}),"\n",(0,i.jsxs)(t.p,{children:["You can retrieve information on the state of CAS in several different ways. If you want a list of all displayed messages, then you can get that directly from ",(0,i.jsx)(t.code,{children:"CasSystem"})," via its ",(0,i.jsx)(t.code,{children:"casActiveMessageSubject"})," property. This property exposes a ",(0,i.jsx)(t.code,{children:"SubscribableArray"})," of messages in the order in which they should be displayed. It is particularly useful when rendering a CAS display component."]}),"\n",(0,i.jsxs)(t.p,{children:["If you need information on whether a particular CAS alert is displayed as a message, deriving it from a list of all displayed messages can be cumbersome. Instead, you can subscribe to the ",(0,i.jsx)(t.code,{children:"cas_alert_displayed"})," and ",(0,i.jsx)(t.code,{children:"cas_alert_hidden"})," event bus topics, defined by the ",(0,i.jsx)(t.code,{children:"CasStateEvents"})," interface. There is also a ",(0,i.jsx)(t.code,{children:"cas_alert_acknowledged"})," topic for when an alert that is displayed as a message has been acknowledged."]}),"\n",(0,i.jsxs)(t.p,{children:["Finally, you can subscribe to the ",(0,i.jsx)(t.code,{children:"cas_master_warning_active"})," and ",(0,i.jsx)(t.code,{children:"cas_master_caution_active"})," topics (also defined by ",(0,i.jsx)(t.code,{children:"CasStateEvents"}),") to consume the master warning and master caution states."]})]})}function h(e={}){let{wrapper:t}={...(0,n.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},250065:function(e,t,s){s.d(t,{Z:function(){return o},a:function(){return r}});var a=s(667294);let i={},n=a.createContext(i);function r(e){let t=a.useContext(n);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(n.Provider,{value:t},e.children)}}}]);