"use strict";(self.webpackChunkdocs_api=self.webpackChunkdocs_api||[]).push([["774146"],{214137:function(e,s,n){n.r(s),n.d(s,{metadata:()=>t,contentTitle:()=>a,default:()=>d,assets:()=>c,toc:()=>l,frontMatter:()=>o});var t=JSON.parse('{"id":"framework-systems/subscriptions/intro-to-subscriptions","title":"Intro to Subscriptions","description":"What are Subscriptions?","source":"@site/docs/framework-systems/subscriptions/intro-to-subscriptions.md","sourceDirName":"framework-systems/subscriptions","slug":"/framework-systems/subscriptions/intro-to-subscriptions","permalink":"/msfs-avionics-mirror/2024/docs/framework-systems/subscriptions/intro-to-subscriptions","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"Intro to Subscriptions","sidebar_position":1},"sidebar":"sidebar","previous":{"title":"Creating Plugins","permalink":"/msfs-avionics-mirror/2024/docs/plugins/creating-plugins"},"next":{"title":"Subscribables","permalink":"/msfs-avionics-mirror/2024/docs/framework-systems/subscriptions/subscribables"}}'),i=n("785893"),r=n("250065");let o={sidebar_label:"Intro to Subscriptions",sidebar_position:1},a="Intro to Subscriptions",c={},l=[{value:"What are Subscriptions?",id:"what-are-subscriptions",level:2},{value:"Creating Subscriptions",id:"creating-subscriptions",level:2},{value:"Event Bus",id:"event-bus",level:3},{value:"Subscribables",id:"subscribables",level:3},{value:"SubEvent",id:"subevent",level:3},{value:"Managing Subscriptions",id:"managing-subscriptions",level:2},{value:"Pause/Resume",id:"pauseresume",level:3},{value:"Initial Notify on Resume",id:"initial-notify-on-resume",level:3},{value:"Destroy",id:"destroy",level:3}];function u(e){let s={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"intro-to-subscriptions",children:"Intro to Subscriptions"})}),"\n",(0,i.jsx)(s.h2,{id:"what-are-subscriptions",children:"What are Subscriptions?"}),"\n",(0,i.jsxs)(s.p,{children:["The avionics framework largely adopts a paradigm where code that needs access to data (consumers) have the data ",(0,i.jsx)(s.em,{children:"pushed"})," to them, as opposed to one where consumers actively query data. In order for consumers to have data pushed to them, they must explicitly enter into a contract with a data source saying, ",(0,i.jsx)(s.em,{children:'"I, the consumer, want to be notified when you, the data source, have something substantive to tell me about."'})," The details of the ",(0,i.jsx)(s.em,{children:'"something substantive"'})," in the contract is left up to the data source to decide and can take many forms, including but not limited to a state change in a value or a triggered event."]}),"\n",(0,i.jsxs)(s.p,{children:["A ",(0,i.jsx)(s.strong,{children:"subscription"})," then, is just such a contract between a consumer and a data source. Within the framework, subscriptions are represented by the ",(0,i.jsx)(s.a,{href:"/msfs-avionics-mirror/2024/docs/api/framework/interfaces/Subscription",children:(0,i.jsx)(s.code,{children:"Subscription"})})," interface."]}),"\n",(0,i.jsx)(s.h2,{id:"creating-subscriptions",children:"Creating Subscriptions"}),"\n",(0,i.jsx)(s.p,{children:"In general, consumers do not directly create subscriptions. Instead, subscriptions are created by invoking methods on data sources to set up notification contracts. Any data source that supports notifying subscribers can be made to generate subscriptions. The rest of this section describes some common framework data sources that generate subscriptions."}),"\n",(0,i.jsx)(s.h3,{id:"event-bus",children:"Event Bus"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.a,{href:"/msfs-avionics-mirror/2024/docs/getting-started/using-the-event-bus",children:"Setting up a handler"})," for an event bus topic will create a subscription for each handler:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"const sub: Subscription = bus.getSubscriber<MyEvents>().on('my_event').handle(() => {\r\n  console.log('my_event was published!');\r\n});\n"})}),"\n",(0,i.jsxs)(s.p,{children:["In the above example, ",(0,i.jsx)(s.code,{children:"sub"})," is a ",(0,i.jsx)(s.code,{children:"Subscription"})," object that represents the new contract created by ",(0,i.jsx)(s.code,{children:"handle()"})," wherein the event bus will call the handler function whenever the ",(0,i.jsx)(s.code,{children:"my_event"})," topic is published."]}),"\n",(0,i.jsx)(s.h3,{id:"subscribables",children:"Subscribables"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.a,{href:"/msfs-avionics-mirror/2024/docs/framework-systems/subscriptions/subscribables",children:"Subscribables"})," are a collection of classes that provide an observable value. Subscribing to one of these objects will create a subscription:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"const sub: Subscription = subscribable.sub(v => {\r\n  console.log(`Value changed to ${v}!`);\r\n});\n"})}),"\n",(0,i.jsxs)(s.p,{children:["In the above example, ",(0,i.jsx)(s.code,{children:"sub"})," is a ",(0,i.jsx)(s.code,{children:"Subscription"})," object that represents the new contract created by ",(0,i.jsx)(s.code,{children:"sub()"})," wherein the subscribable will call the handler function whenever its value changes."]}),"\n",(0,i.jsx)(s.h3,{id:"subevent",children:"SubEvent"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.a,{href:"/msfs-avionics-mirror/2024/docs/api/framework/classes/SubEvent",children:"SubEvent"})," is a class that supports publishing events and can be thought of as a more localized version of the event bus. Subscribing to a ",(0,i.jsx)(s.code,{children:"SubEvent"})," will create a subscription:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"const sub: Subscription = subEvent.on((sender, data) => {\r\n  console.log(`An event was triggered with data ${data}!`);\r\n});\n"})}),"\n",(0,i.jsxs)(s.p,{children:["In the above example, ",(0,i.jsx)(s.code,{children:"sub"})," is a ",(0,i.jsx)(s.code,{children:"Subscription"})," object that represents the new contract created by ",(0,i.jsx)(s.code,{children:"on()"})," wherein the ",(0,i.jsx)(s.code,{children:"SubEvent"})," will call the handler function whenever an event is triggered by calling the ",(0,i.jsx)(s.code,{children:"SubEvent"}),"'s ",(0,i.jsx)(s.code,{children:"notify()"})," method."]}),"\n",(0,i.jsx)(s.h2,{id:"managing-subscriptions",children:"Managing Subscriptions"}),"\n",(0,i.jsxs)(s.p,{children:["Once a subscription is created, a consumer can use it to manage the new notification contract established between it and the data source. Subscriptions support three basic operations: ",(0,i.jsx)(s.strong,{children:"pause"}),", ",(0,i.jsx)(s.strong,{children:"resume"}),", and ",(0,i.jsx)(s.strong,{children:"destroy"}),"."]}),"\n",(0,i.jsx)(s.h3,{id:"pauseresume",children:"Pause/Resume"}),"\n",(0,i.jsxs)(s.p,{children:["Pausing/resuming a subscription controls whether notifications are received from its data source. A paused subscription will not receive any notifications, while a resumed subscription will. Subscriptions can be paused and resumed at will, and there is no limit to how many times a subscription can toggle between the two states. The ",(0,i.jsx)(s.code,{children:"pause()"})," and ",(0,i.jsx)(s.code,{children:"resume()"})," methods are used to pause and resume subscriptions, respectively:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"// Subject is a Subscribable.\r\nconst subject = Subject.create(0);\r\n\r\nconst sub = subject.sub(v => {\r\n  console.log(`Value changed to ${v}!`);\r\n});\r\n\r\nsub.pause();\r\nsubject.set(5); // No console message will be logged.\r\n\r\nsub.resume();\r\nsubject.set(10); // 'Value changed to 10!' will be logged.\n"})}),"\n",(0,i.jsx)(s.p,{children:"Generally, newly created subscriptions are initialized as resumed, but some data sources will allow you to initialize subscription to the paused state instead:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"const subEvent = new SubEvent<void, number>();\r\n\r\n// The second argument passed to on() controls whether the new subscription is initially paused.\r\nconst sub = subEvent.on((sender, data) => {\r\n  console.log(`An event was triggered with data ${data}!`);\r\n}, true);\r\n\r\nsubEvent.notify(undefined, 5); // No console message will be logged.\r\n\r\nsub.resume();\r\nsubEvent.notify(undefined, 10); // 'An event was triggered with data 10!' will be logged.\n"})}),"\n",(0,i.jsx)(s.h3,{id:"initial-notify-on-resume",children:"Initial Notify on Resume"}),"\n",(0,i.jsx)(s.p,{children:'When resuming certain subscriptions, you can control whether an initial notification will be sent immediately when it is resumed. This initial notify operation is primarily useful for subscriptions in which the data source is notifying the consumer about state changes. In such cases, initial notify can be used to "sync" the consumer with the current state of the data source as soon as it is resumed rather than waiting (potentially forever) for the state to change again:'}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"// Subject is a Subscribable.\r\nconst subject = Subject.create(0);\r\n\r\nconst sub = subject.sub(v => {\r\n  console.log(`Value changed to ${v}!`);\r\n});\r\n\r\nsub.pause();\r\nsubject.set(5); // No console message will be logged.\r\n\r\nsub.resume(true); // 'Value changed to 5!' will be logged.\n"})}),"\n",(0,i.jsx)(s.p,{children:"Not all subscriptions support initial notify on resume. In particular, subscriptions for event notifications that are not tied to some persistent state typically do not support initial notify. For example:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"const subEvent = new SubEvent<void, number>();\r\n\r\nconst sub = subEvent.on((sender, data) => {\r\n  console.log(`An event was triggered with data ${data}!`);\r\n});\r\n\r\nsub.pause();\r\nsubEvent.notify(undefined, 5); // No console message will be logged.\r\n\r\nsub.resume(true); // No console message will be logged.\n"})}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"canInitialNotify"})," property on a ",(0,i.jsx)(s.code,{children:"Subscription"})," object reports whether that particular subscription supports initial notify on resume. If ",(0,i.jsx)(s.code,{children:"canInitialNotify"})," is ",(0,i.jsx)(s.code,{children:"false"}),", then initial notify on resume will always fail on that subscription. If the property is ",(0,i.jsx)(s.code,{children:"true"}),", then initial notify ",(0,i.jsx)(s.em,{children:"may"})," work but is not guaranteed to do so under all circumstances. For example, all subscriptions created by setting up event bus handlers report ",(0,i.jsx)(s.code,{children:"canInitialNotify"})," as ",(0,i.jsx)(s.code,{children:"true"}),", but initial notify will only work if the subscription's associated topic has cached data published to it:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"const sub1 = bus.getSubscriber<MyEvents>().on('my_event_1').handle(v => {\r\n  console.log(`my_event_1 was published with data ${v}!`);\r\n});\r\nconst sub2 = bus.getSubscriber<MyEvents>().on('my_event_2').handle(v => {\r\n  console.log(`my_event_2 was published with data ${v}!`);\r\n});\r\n\r\nsub1.pause();\r\nsub2.pause();\r\n\r\n// The last argument passed to pub() controls whether published data is cached.\r\nbus.getPublisher<MyEvents>().pub('my_event_1', 5, false, false);\r\nbus.getPublisher<MyEvents>().pub('my_event_2', 5, false, true);\r\n\r\nsub1.resume(true); // No console message will be logged.\r\nsub2.resume(true); // 'my_event_2 was published with data 5!' will be logged.\n"})}),"\n",(0,i.jsx)(s.admonition,{type:"note",children:(0,i.jsxs)(s.p,{children:["Some subscriptions ",(0,i.jsx)(s.em,{children:"always"})," trigger an initial notification when resumed, even if ",(0,i.jsx)(s.code,{children:"false"})," is passed as the ",(0,i.jsx)(s.code,{children:"initialNotify"})," argument to ",(0,i.jsx)(s.code,{children:"resume()"}),". Examples of subscriptions that behave like this include ",(0,i.jsx)(s.a,{href:"/msfs-avionics-mirror/2024/docs/framework-systems/subscriptions/subscribables#consumersubject",children:(0,i.jsx)(s.code,{children:"ConsumerSubject"})})," and ",(0,i.jsx)(s.a,{href:"/msfs-avionics-mirror/2024/docs/framework-systems/subscriptions/subscribables#mapping-a-subscribable-to-new-subscribables",children:"mapped subscribables"}),"."]})}),"\n",(0,i.jsx)(s.p,{children:"Some data sources allow you to specify whether subscriptions should be resumed with initial notify immediately upon creation while others always perform an initial notify on newly created resumed subscriptions:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"// Subject is a Subscribable.\r\nconst subject = Subject.create(0);\r\n\r\n// The second argument passed to sub() controls whether to perform an initial notify if the subscription is created as resumed.\r\nsubject.sub(v => {\r\n  console.log(`Value changed to ${v}!`);\r\n}, true); // 'Value changed to 0!' will be logged.\r\n\r\n// ----------------\r\n// ----------------\r\n\r\nbus.getPublisher<MyEvents>().pub('my_event', 5, false, true);\r\n\r\n// handle() always performs an initial notify if the subscription is created as resumed.\r\nbus.getSubscriber<MyEvents>().on('my_event').handle(v => {\r\n  console.log(`my_event was published with data ${v}!`);\r\n}); // 'my_event was published with data 5!' will be logged.\n"})}),"\n",(0,i.jsxs)(s.admonition,{type:"tip",children:[(0,i.jsxs)(s.p,{children:["If you want to set up an event bus handler ",(0,i.jsx)(s.em,{children:"without"})," an initial notify when the subscription is created, then create the subscription as paused and immediately resume the subscription without initial notify:"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"bus.getSubscriber<MyEvents>().on('my_event').handle(v => {\r\n  console.log(`my_event was published with data ${v}!`);\r\n}, true).resume();\n"})})]}),"\n",(0,i.jsx)(s.h3,{id:"destroy",children:"Destroy"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"Subscription"})," objects can be destroyed by calling their ",(0,i.jsx)(s.code,{children:"destroy()"})," methods. Destroying a subscription permanently stops notifications from being received from its data source. Once destroyed, a subscription can no longer be paused or resumed (attempting to do so will result in runtime errors being thrown)."]}),"\n",(0,i.jsx)(s.p,{children:"When a subscription is created, a strong reference to the subscription is created and stored within the subscription's data source. As long as that reference exists (and assuming the data source has not been garbage collected), the subscription and anything it references (which usually includes things like associated handler functions) cannot be garbage collected. Therefore, it is imperative that subscriptions be destroyed once they are at the end of their useful lives. Failure to do so may result in memory leaks."}),"\n",(0,i.jsx)(s.admonition,{type:"note",children:(0,i.jsx)(s.p,{children:"Although destroying and re-creating subscriptions achieves the same end result as pausing/resuming, the former strategy incurs additional performance and memory allocation overhead. Therefore, it is recommended to pause/resume subscriptions whenever possible and only destroy them when they never need to be resumed again."})})]})}function d(e={}){let{wrapper:s}={...(0,r.a)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},250065:function(e,s,n){n.d(s,{Z:function(){return a},a:function(){return o}});var t=n(667294);let i={},r=t.createContext(i);function o(e){let s=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);